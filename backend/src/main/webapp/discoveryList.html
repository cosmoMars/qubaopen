<!DOCTYPE html>
<html>
<head lang="zh_cn">
    <meta charset="UTF-8">
    <title>发现列表</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">

    <style>
        .marketing{
            margin-top: 100px;;
        }

        .gone{
            display: none;
        }

        .addTopic,.addSelf{
            -webkit-transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }

        .red{
            color: #ff514c;
        }

        .glyphicon-refresh{
            -webkit-transition:rotate 1s ease-in-out;
            -moz-transition:rotate 1s ease-in-out;
            -o-transition:rotate 1s ease-in-out;
            -ms-transition:rotate 1s ease-in-out;
            transition:rotate 1s ease-in-out;
        }

        .glyphicon-refresh:hover{
            font-weight: bolder;
        }

        .rotate{
            animation:rotate 1s;
            -webkit-animation:rotate 1s;
        }

        @keyframes rotate
        {
            0%   {
                -webkit-transform:rotate(0deg);
                -moz-transform:rotate(0deg);
                -o-transform:rotate(0deg);
                -ms-transform:rotate(0deg);
                transform:rotate(0deg);
            }
            50%  {
                -webkit-transform:rotate(360deg);
                -moz-transform:rotate(360deg);
                -o-transform:rotate(360deg);
                -ms-transform:rotate(360deg);
                transform:rotate(360deg);
            }
            100% {
                -webkit-transform:rotate(720deg);
                -moz-transform:rotate(720deg);
                -o-transform:rotate(720deg);
                -ms-transform:rotate(720deg);
                transform:rotate(720deg);
            }
        }

        @-webkit-keyframes  rotate
        {
            0%   {
                -webkit-transform:rotate(0deg);
                -moz-transform:rotate(0deg);
                -o-transform:rotate(0deg);
                -ms-transform:rotate(0deg);
                transform:rotate(0deg);
            }
            50%  {
                -webkit-transform:rotate(360deg);
                -moz-transform:rotate(360deg);
                -o-transform:rotate(360deg);
                -ms-transform:rotate(360deg);
                transform:rotate(360deg);
            }
            100% {
                -webkit-transform:rotate(720deg);
                -moz-transform:rotate(720deg);
                -o-transform:rotate(720deg);
                -ms-transform:rotate(720deg);
                transform:rotate(720deg);
            }
        }

    </style>
</head>
<body>


<div class="container marketing">

    <div class="row">
        <div class="col-sm-3">
            <button type="button" id="btn-add" class="btn btn-primary">新增专栏</button>
        </div>

        <div class="col-sm-9">
            <button type="button" id="btn-refresh" class="btn btn-primary">刷新列表</button>
        </div>
    </div>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>发现ID</th>
            <th>专栏</th>
            <th>测评</th>
            <th>时间</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="tableView">
        <!--<tr data-aid="1">-->
            <!--<th scope="row">1</th>-->
            <!--<td>论持久战</td>-->
            <!--<td>2014-12-12 15:15:13</td>-->
            <!--<td>2015-02-27</td>-->
            <!--<td><span class="check">查看</span> <span class="delete">删除</span></td>-->
        <!--</tr>-->

        <!--<tr data-aid="2">-->
            <!--<th scope="row">1</th>-->
            <!--<td>论持久战</td>-->
            <!--<td>2014-12-12 15:15:13</td>-->
            <!--<td>2015-02-27</td>-->
            <!--<td><span class="check">查看</span> <span class="delete">删除</span></td>-->
        <!--</tr>-->
        </tbody>

    </table>

    <nav>
        <ul class="pager">
            <li class="disabled"><a href="#">上一页</a></li>
            <li class="disabled"><a href="#">下一页</a></li>
        </ul>
    </nav>

    <!-- 模态框（Modal） -->
    <div class="modal" id="myModal" tabindex="-1" role="dialog" data-did=""
         aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        编辑发现
                    </h4>
                </div>
                <div class="modal-body">


                    <form class="form-inline">
                        <div class="form-group">
                            <label for="topicId">专栏</label>
                            <input type="text" class="form-control" id="topicId" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="selfId">测评</label>
                            <input type="text" class="form-control" id="selfId" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="selfId">时间</label>
                            <input type="text" class="form-control" id="time" placeholder="">
                        </div>
                    </form>

                    <div class="row" style="margin-top: 20px;">
                        <ul class="nav nav-tabs nav-justified" role="tablist">
                            <li role="presentation" id="btn-inCash" class="active"><a href="#home" role="tab" data-toggle="tab">专栏</a></li>
                            <li role="presentation" id="btn-outCash"><a href="#profile" role="tab" data-toggle="tab">测评</a></li>
                        </ul>
                    </div>

                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="home">
                            <div class="table-responsive">

                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>专栏</th>
                                        <th>时间</th>
                                        <th>最近加入发现时间</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody id="topicTableView">
                                    <!--<tr data-aid="1">-->
                                        <!--<th scope="row">1</th>-->
                                        <!--<td>论持久战</td>-->
                                        <!--<td>2014-12-12 15:15:13</td>-->
                                        <!--<td>2015-02-27</td>-->
                                        <!--<td><span class="addTopic glyphicon glyphicon-plus-sign"></span></td>-->
                                    <!--</tr>-->

                                    <!--<tr data-aid="2">-->
                                        <!--<th scope="row">2</th>-->
                                        <!--<td>论持久战</td>-->
                                        <!--<td>2014-12-12 15:15:13</td>-->
                                        <!--<td>2015-02-27</td>-->
                                        <!--<td><span class="addTopic glyphicon glyphicon-plus-sign"></span></td>-->
                                    <!--</tr>-->
                                    </tbody>

                                </table>
                                <nav>
                                    <ul class="pager">
                                        <span id="refreshTopic" class="glyphicon glyphicon-refresh"></span>
                                        <li class="disabled"><a href="#">上一页</a></li>
                                        <li class="disabled"><a href="#">下一页</a></li>
                                    </ul>
                                </nav>

                            </div>
                        </div>

                        <div role="tabpanel" class="tab-pane" id="profile">
                            <div class="table-responsive">

                                <table class="table table-striped">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>测评</th>
                                        <th>时间</th>
                                        <th>最近加入发现时间</th>
                                        <th></th>
                                    </tr>
                                    </thead>
                                    <tbody id="selfTableView">
                                    <!--<tr data-aid="1">-->
                                        <!--<th scope="row">11</th>-->
                                        <!--<td>论持久战1</td>-->
                                        <!--<td>2014-12-12 15:15:13</td>-->
                                        <!--<td>2015-02-27</td>-->
                                        <!--<td><span class="addSelf glyphicon glyphicon-plus-sign"></span></td>-->
                                    <!--</tr>-->

                                    <!--<tr data-aid="2">-->
                                        <!--<th scope="row">15</th>-->
                                        <!--<td>论持久战</td>-->
                                        <!--<td>2014-12-12 15:15:13</td>-->
                                        <!--<td>2015-02-27</td>-->
                                        <!--<td><span class="addSelf glyphicon glyphicon-plus-sign"></span></td>-->
                                    <!--</tr>-->
                                    </tbody>

                                </table>

                                <nav>
                                    <ul class="pager">
                                        <span id="refreshSelf" class="glyphicon glyphicon-refresh"></span>
                                        <li class="disabled"><a href="#">上一页</a></li>
                                        <li class="disabled"><a href="#">下一页</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">关闭
                    </button>
                    <button type="button" id="btn-confirm" class="btn btn-primary">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

</div>


</div>

<script src="js/globalVariable.js"></script>
<script src="js/jquery-2.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
        $(document).ready(function () {

            var data = {"success":"1",data:[
                {id:1,topicId:"1",topicName:"专栏1",selfId:"1",selfName:"测评1","time":"2015-02-27"},
                {id:2,topicId:"2",topicName:"专栏2",selfId:"2",selfName:"测评2","time":"2015-02-28"},
                {id:3,topicId:"3",topicName:"专栏3",selfId:"3",selfName:"测评3","time":"2015-03-01"},
                {id:4,topicId:"4",topicName:"专栏4",selfId:"4",selfName:"测评4","time":"2015-03-02"}]};

            //点击新增
            $("#btn-add").on("click",function(){
                $('#myModal').modal();

                //清除之前的数据
                $("#myModal").attr("data-did","");
                $("#topicId").val("");
                $("#selfId").val("");
            });


            //点击查看
            $(document).on("click",".check",function(){
                console.log("check");
                $('#myModal').modal();
                var id=$(this).closest("tr").attr("data-did");
                var topicId=$(this).closest("tr").attr("data-tid");
                var selfId=$(this).closest("tr").attr("data-sid");

                $("#myModal").attr("data-did",id);
                $("#topicId").val(topicId);
                $("#selfId").val(selfId);

            });

            //点击提交
            $("#btn-confirm").on("click",function(){
                var id=$("#myModal").attr("data-did");
                var topicId= $("#topicId").val();
                var selfId=$("#selfId").val();
                var time=$("#time").val();

                if(!topicId){
                    alert("专栏不能为空");
                    return;
                }
                if(!selfId){
                    alert("测评不能为空");
                    return;
                }

                var jsonSent={};
                jsonSent.topicId=topicId;
                jsonSent.selfId=selfId;

                if(id){
                    jsonSent.id=id;
                    console.log("modify");
                }else{
                    console.log("add");
                }

                if(time){
                    jsonSent.time=time;
                }

                console.log(jsonSent);
                editDiscovery(jsonSent);
            });


            var dPage= 0,tPage= 0,sPage= 0;


            //点击刷新
            $("#btn-refresh").on("click",function(){
                var bChecked=$("#checkboxWarning").is(":checked");
                getDiscoveryList();
                //updateList(data.data);
            });

            //点击刷新 专栏
            $("#refreshTopic").on("click",function(){
                //var _this=this;
                $(this).addClass("rotate");
                getTopicList();
                //setTimeout(function(){$(_this).removeClass("rotate")},1000);
            });

            //点击刷新 测评
            $("#refreshSelf").on("click",function(){
                getSelfList();
            });


            //点击删除
            $(document).on("click",".delete",function(){
                if(confirm("确认删除")){
                    console.log("delete"+$(this).closest("tr").attr("data-aid"));
                }
            });

            //点击 + 号
            $(document).on("click",".addTopic",function(){
                var id=$(this).closest("tr").attr("data-aid");
                $("#topicId").val(id);
            });
            $(document).on("click",".addSelf",function(){
                var id=$(this).closest("tr").attr("data-aid");
                $("#selfId").val(id);
            });



            $("#topicId").on("focus",function(){
                $('#btn-inCash a').tab('show');
                $(".addTopic").addClass("red");
                setTimeout(function(){
                    $(".addTopic").removeClass("red");
                },300);
                setTimeout(function(){
                    $(".addTopic").addClass("red");
                },600);
                setTimeout(function(){
                    $(".addTopic").removeClass("red");
                },900);
            });

            $("#selfId").on("focus",function(){
                $('#btn-outCash a').tab('show')
                $(".addSelf").addClass("red");
                setTimeout(function(){
                    $(".addSelf").removeClass("red");
                },300);
                setTimeout(function(){
                    $(".addSelf").addClass("red");
                },600);
                setTimeout(function(){
                    $(".addSelf").removeClass("red");
                },900);
            });


            //updateDiscoveryList(data.data);

            getDiscoveryList();
            getTopicList();
            getSelfList();


// 获得对应的事件名字
            var animateEvent = function () {
                var el = document.createElement('div');
                var map = {
                    animation: 'animationend',
                    MozAnimation: 'animationend',
                    WebkitAnimation: 'webkitAnimationEnd'
                };

                for (var name in map) {
                    if (el.style[name] !== undefined) {
                        return map[name];
                    }
                }
            }();

            $('#refreshTopic').on(animateEvent, function () {
                $(this).removeClass("rotate")
            });


            /*获取发现列表*/
            function getDiscoveryList(page){
                var p=0;
                if(page){
                    p=page;
                }
                $.ajax({
                    url:prevUrl+"/dailyDiscovery/retrieveDailyDiscoverys?size=10&page="+p,
                    type: "GET",
                    async:false,
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        var result = data.success;

                        console.log(data);

                        if (result == 1) {
                            updateDiscoveryList(data.list);
                        }else if (result == 0) {
                            alert("请求错误");
                        }
                    }
                });
            }

            /*获取专栏列表*/
            function getTopicList(){
                $.ajax({
                    url:prevUrl+"/dailyDiscovery/retrieveTopic?join=false&size=10",
                    type: "GET",
                    async:false,
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        var result = data.success;

                        console.log(data);

                        if (result == 1) {
                            updateTopicList(data.list);
                        }else if (result == 0) {

                            alert("请求错误");
                        }
                    }
                });
            }

            /*获取测评列表*/
            function getSelfList(){
                $.ajax({
                    url:prevUrl+"/dailyDiscovery/retrieveSelf?join=false&size=10",
                    type: "GET",
                    async:false,
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        var result = data.success;

                        console.log(data);

                        if (result == 1) {
                            updateSelfList(data.list);
                        }else if (result == 0) {

                            alert("请求错误");
                        }
                    }
                });
            }

            /*新增 修改专栏*/
            function editDiscovery(jsonSent){
                $.ajax({
                    url:prevUrl+"/dailyDiscovery/generateDailyDiscovery",
                    type: "POST",
                    data:jsonSent,
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        var result = data.success;
                        console.log(data);

                        $('#myModal').modal("hide");

                        refreshList();

                        if (result == 1) {
                        }else if (result == 0) {
                        }
                    }
                });
            }

            /*删除专栏*/
            function deleteTopic(id){
                $.ajax({
                    url:"/booking/retrieveHistory",
                    type: "POST",
                    dataType: "json",
                    success: function (data, textStatus, jqXHR) {

                        var result = data.success;
                        console.log(data);

                        if (result == 1) {
                        }else if (result == 0) {
                        }
                    }
                });
            }


            function updateDiscoveryList(data){

                var oTableView=$("#tableView");

                oTableView.empty();

                var appendHTML;
                for(var i=0;i<data.length;i++){
                    appendHTML="";

                    appendHTML+=
                            '<tr data-did="'+data[i].id+'" data-tid="'+data[i].topicId+'" data-sid="'+data[i].selfId+'">' +
                            '<th scope="row">'+data[i].id+'</th>' +
                            '<td>'+data[i].topicId+'、'+data[i].topicName+'</td>' +
                            '<td>'+data[i].selfId+'、'+data[i].selfName+'</td>' +
                            '<td>'+data[i].time+'</td>' +
                            '<td><span class="check">查看</span> <span class="delete">删除</span></td>' +
                            '<td class="gone content">'+data[i].content+'</td>' +
                            '</tr>';

                    oTableView.append(appendHTML);
                }
            }

            function updateTopicList(data){

                var oTableView=$("#topicTableView");

                oTableView.empty();

                var appendHTML;
                for(var i=0;i<data.length;i++){
                    appendHTML="";

                    appendHTML+=
                            '<tr data-aid="'+data[i].id+'">' +
                            '<th scope="row">'+data[i].id+'</th>' +
                            '<td class="name">'+data[i].name+'</td>' +
                            '<td>'+data[i].createdDate+'</td>' +
                            '<td>'+data[i].dailyTime+'</td>' +
                            '    <td><span class="addTopic glyphicon glyphicon-plus-sign"></span></td>' +
                            '<td class="gone content">'+data[i].content+'</td>' +
                            '</tr>';

                    oTableView.append(appendHTML);
                }
            }

            function updateSelfList(data){

                var oTableView=$("#selfTableView");

                oTableView.empty();

                var appendHTML;
                for(var i=0;i<data.length;i++){
                    appendHTML="";

                    appendHTML+=
                            '<tr data-aid="'+data[i].id+'">' +
                            '<th scope="row">'+data[i].id+'</th>' +
                            '<td class="name">'+data[i].name+'</td>' +
                            '<td>'+data[i].createdDate+'</td>' +
                            '<td>'+data[i].dailyTime+'</td>' +
                            '    <td><span class="addSelf glyphicon glyphicon-plus-sign"></span></td>' +
                            '<td class="gone content">'+data[i].content+'</td>' +
                            '</tr>';

                    oTableView.append(appendHTML);
                }
            }

            function refreshList(){
                getDiscoveryList();
                getTopicList();
                getSelfList();
            }


        });
    </script>
</body>
</html>