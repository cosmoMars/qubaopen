<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="../img/29.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日程表</title>
    <!-- Bootstrap core CSS -->
    <link href="../bootstrap/css/bootstrap.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        body{
            background-color: #efefef;
            font-family: "微软雅黑", serif;
        }

        .main-view{
            margin: 0 auto;
            background-color: #fff;
            height: 455px;
            width: 400px;
            overflow-y: scroll;
        }

        .title-view{
            margin: 10px auto 0 auto;
            background-color: #efefef;
            width: 400px;
        }

        @media screen and ( max-width: 400px){
            .main-view , .title-view{
                width: 100%;
            }
        }



        /*最上标题栏 M月N日~M月N日 */
        #prev-week{
            width: 20%;
            cursor: pointer;
            padding-left: 10px;
        }

        #next-week{
            width: 20%;
            cursor: pointer;
            padding-right: 10px;
            text-align: right;
        }

        #title-month{
            width: 60%;
            text-align: center;
        }

        /* 第二层标题栏 显示一周标题 周日 周一 周二... */
        .title-week , .title-month {
            font-size: 12px;
            background-color: #efefef;
            border-spacing: 0;
            width: 100%;
        }

        .title-week td:nth-child(n+2){
            width: 13.3%;
            border: 1px solid #efefef;
            text-align: center;
        }


        .main-table{
            border-spacing: 0;
            width: 100%;
            text-align: center;
        }

        .main-table td:nth-child(n+2){
            width: 13.3%;
            border: 1px solid #efefef;
            height: 75px;
            cursor: pointer;
            /*max-width: 64px;*/
        }
        .time{
            border: 1px solid #efefef;
            width: 6.9%;
            font-family:   Arial, sans-serif;
            vertical-align: text-top;
            text-align: right;
            padding-top: 3px;
            padding-right: 3px;
        }

        .main-table .time{
            background-color: #e3e3e3;
        }

        .color-over{
            background-color: #e3e3e3;
        }

        .color-work{
            color: #fff;
            background-color: #6365CC;
        }


        .color-weekend{
            color: #888;
        }

        .color-today{
            font-weight: 900;
            color: #9f0707;
        }

        .color-select{
            width: 100%;
            height: 100%;
            color: #fff;
            font-size: 16px;
            background-color: #47BCE7;
            opacity: 0.8;
            display: table;
            text-align: center;
        }
        .color-select span{
            display: table-cell;
            vertical-align: middle;
        }

        .main-table td.color-current{
            border: 0;
        }
        .color-current{
            /*现在通过js计算*/
            /*-moz-box-shadow: 0 40px 0 0 #e3e3e3 inset;*/
            /*-webkit-box-shadow: 0 40px 0 0 #e3e3e3 inset;*/
            /*box-shadow: 0 0 #e3e3e3,*/
            /*0 40px 0 0 #e3e3e3 inset,*/
            /*0 0 #e3e3e3,*/
            /*0 41px 0 0 #f00 inset;*/
        }

        .carousel-inner .active{
            display: table;
        }
        .carousel-inner .left,.carousel-inner .right{
            display: table;
        }





    </style>

</head>
<body>


<div class="title-view">
    <table class="title-month">
        <tr>
           <td id="prev-week"><span class="glyphicon glyphicon-chevron-left"></span></td><td id="title-month">日程管理</td><td id="next-week"><span class="glyphicon glyphicon-chevron-right"></span></td>
        </tr>
    </table>
    <table class="title-week">
        <tr>
            <td class="time"></td><td class="color-weekend">周日</td><td>周一</td><td>周二</td><td>周三</td><td>周四</td><td>周五</td><td class="color-weekend">周六</td>
        </tr>
    </table>
    <div class="carousel slide" data-ride="carousel">
        <div id="title-week-day" class="carousel-inner" role="listbox">

            <table class="title-week title-week-day item" data-page="-1">
                <tr>
                    <td class="time"></td><td class="color-weekend">07</td><td>08</td><td>09</td><td>10</td><td>11</td><td>12</td><td>13</td>
                </tr>
            </table>


            <table class="title-week title-week-day item active" data-page="0">
                <tr>
                    <td class="time"></td><td>07</td><td>08</td><td>09</td><td>10</td><td>11</td><td>12</td><td>13</td>
                </tr>
            </table>


            <table class="title-week title-week-day item" data-page="1">
                <tr>
                    <td class="time"></td><td>07</td><td>08</td><td>09</td><td>10</td><td>11</td><td>12</td><td>13</td>
                </tr>
            </table>

        </div>
    </div>
</div>

<div class="main-view carousel slide" data-ride="carousel">
    <div id="main-view" class="carousel-inner" role="listbox">


    <!--<table class="item main-table" data-page="-1">-->
        <!--<tr class="">-->
            <!--<td class="time">7</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td class="time">8</td><td class="color-over"></td><td></td><td class="color-work">订单1</td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">9</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">10</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">11</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">12</td><td class="color-over">有事1</td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">13</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">14</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">15</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->
    <!--</table>-->

    <!--<table class="item main-table active" data-page="0">-->
        <!--<tr class="">-->
            <!--<td class="time">7</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td class="time">8</td><td class="color-over"></td><td></td><td class="color-work">订单1</td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">9</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">10</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">11</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">12</td><td class="color-over">有事2</td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">13</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">14</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">15</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->
    <!--</table>-->

    <!--<table class="item main-table" data-page="1">-->
        <!--<tr class="">-->
            <!--<td class="time">7</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td class="time">8</td><td class="color-over"></td><td></td><td class="color-work">订单1</td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">9</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">10</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">11</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">12</td><td class="color-over">有事3</td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">13</td><td class="color-over"></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">14</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">15</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->

        <!--<tr>-->
            <!--<td class="time">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>-->
        <!--</tr>-->
    <!--</table>-->

    </div>
</div>



<!-- 模态框（Modal） -->
<div class="modal" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    添加安排
                </h4>
            </div>
            <div class="modal-body">

                <form class="form-horizontal form-profile" role="form" enctype="multipart/form-data" method="post" id="uploadPhotoForm">
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <input type="text" class="form-control" id="realname" autocomplete="off"
                                   placeholder="活动内容" required>
                        </div>
                    </div>
                    <div class="form-group ">
                        <label for="starttime" class=" col-sm-2 control-label">开始时间</label>
                        <div class="col-sm-10" >
                            <input class="form-control form_datetime" size="16"  type="text" value="" data-date-format="yyyy-mm-dd hh:ii:00"  id="starttime" readonly>

                        </div>
                    </div>
                    <div class="form-group ">
                        <label for="endtime" class=" col-sm-2 control-label">结束时间</label>
                        <div class="col-sm-10" >
                            <input class="form-control form_datetime" size="16"  type="text" value="" data-date-format="yyyy-mm-dd hh:ii:00"  id="endtime" readonly>
                        </div>
                    </div>

                    <div class="form-group ">
                        <label for="repeat" class=" col-sm-2 control-label">重复</label>
                        <div class="col-sm-10" >
                            <select id="repeat" class="form-control">
                                <option>一次性活动</option>
                                <option>每天</option>
                                <option>每周</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group ">
                        <label for="remind" class=" col-sm-2 control-label">提醒</label>
                        <div class="col-sm-10" >
                            <select id="remind" class="form-control">
                                <option>不提醒</option>
                                <option selected>10分钟前</option>
                                <option>30分钟前</option>
                            </select>
                        </div>
                    </div>


                </form>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary">
                    提交更改
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<!-- Placed at the end of the document so the pages load faster -->
<script src="../jquery/jquery-1.11.1.min.js"></script>
<script src="../bootstrap/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../assets/js/ie10-viewport-bug-workaround.js"></script>

<script src="../knight/js/main.js"></script>
<script src="../knight/js/scheduler.js"></script>



<link href="../plugin/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
<script src="../plugin/datetimepicker/js/bootstrap-datetimepicker.js"></script>
<script src="../plugin/datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script>

    $(document).ready(function () {



        /* 设置表格自动的时间 */
        $('.carousel').carousel({
            interval: 20000000
        });
        //选择日期控件 生日
        $('.form_datetime').datetimepicker({
            language: 'zh-CN',
            weekStart: 1,
            todayBtn: 0,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            minView: 0,
            forceParse: 0
        });


        $(".title-view").css("padding-right",$(".main-view").width()-$(".main-table").width());
//        alert($(window).width());

        $("#prev-week").on("click",function(){
            $('.carousel').carousel('prev');
            updateTitleWeekDayTable();
            updateMainTable();

        });
        $("#next-week").on("click",function(){
            $('.carousel').carousel('next');
            updateTitleWeekDayTable();
            updateMainTable();
        });



        /* 主表格 点击事件 */
        $(document).on("click",".main-table tr td",function(){

            if($(this).has(".color-select").size()>0){
                //do ...
                $('#myModal').modal('show');
                //$("head").append('<style> .main-table td:nth-child(n+2){width: 13.3%;border: 1px solid #efefef;height: 95px;cursor: pointer;}</style>')
            }else{
                if(!$(this).hasClass("time") &&  !$(this).hasClass("color-work") && !$(this).hasClass("color-over") ){
//                    $(".color-select").remove();
//                    $(this).empty().append('<div class="color-select"><span class="glyphicon glyphicon-plus"></span></div>');
                }

            }

        });
    });
    Date.prototype.addDays = Date.prototype.addDays || function(days){
        this.setDate(this.getDate() + days);
        return this;
    };
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };




    /**
     * 获取一周日期
     * page:向前向后周数 ，page -1 上周  page 1  下周 默认0
     * */
    function getDayOfOneWeek(page){
        page=!!page?page:0;
        var today=new Date();
        var today_first=today.addDays(0-today.getDay()+7*page);

        var aDate=[];
        for(var i=0;i<7;i++){
            var tDate=new Date(today_first.getTime());
            aDate.push(tDate.addDays(i));
        }
        return aDate;
    }

    /**
     * 构造一周的html
     * aDate：一周时间 数组
     * */
    function getTitleWeekDayTableHTML(aDate){
        var appendHTML='<tr><td class="time"></td>';
        for(var i=0;i<aDate.length;i++){
            if(i==0 || i==6){
                appendHTML+='<td class="color-weekend">'+(aDate[i].getMonth()+1)+"/"+ aDate[i].getDate() + '</td>';
            }else{
                appendHTML+='<td>'+(aDate[i].getMonth()+1)+"/"+ aDate[i].getDate() + '</td>';
            }
        }
        appendHTML+="</tr>";
        return appendHTML;
    }

    /**
     * 构造一周的主表html
     * aDate：一周时间 数组
     * iPage：当前页
     * aData：数据
     * */
    function getOneWeekMainTable(aDate,iPage){


        var appendHTML='<table class="item main-table"  data-page="'+iPage+'">';
        if(iPage==0){
            /*当前日期页  第0页显示*/
            appendHTML='<table class="item main-table active"  data-page="'+iPage+'">';
        }
        var today=new Date();
        //console.log(aDate);
        for(var i=0;i<24;i++){
            appendHTML+='<tr>';
            for(var j=0;j<=7;j++){
                if(j==0){
                    /*第一列是 时间*/
                    if(i<10){
                        /*个位数前面加个0*/
                        appendHTML+='<td class="time">'+'0'+i+'</td>';
                    }else{
                        appendHTML+='<td class="time">'+i+'</td>';
                    }
                }else{
                    if(today.getYear()==aDate[j-1].getYear() && today.getMonth()==aDate[j-1].getMonth() && today.getDate()==aDate[j-1].getDate()){

                        if(today.getHours() > i ){
                            appendHTML+='<td class="color-over"></td>';
                        }else if(today.getHours() == i ){
                            var height=today.getMinutes()/60 * 75;
                            var styleHTML='style="box-shadow: 0 0 #e3e3e3, 0px '+height+'px 0 0 #e3e3e3 inset,  0 0 #e3e3e3,  0 '+(height+2)+'px 0 0 #f00 inset;"';

                            appendHTML+='<td class="color-current" '+styleHTML+'></td>';
                        }
                        else{
                            appendHTML+='<td class=""></td>';
                        }
                        continue;
                    }

                    if(today > aDate[j-1]){
                        appendHTML+='<td class="color-over"></td>';
                    }
                    else{
                        appendHTML+='<td class=""></td>';
                    }

                }
            }
            appendHTML+='</tr>';
        }
        appendHTML+='</table>';
        return appendHTML;
    }


    /*初始化 表格*/
    updateTitleWeekDayTable(true);
    updateMainTable(true);

    /* 滚动到当前小时 */
    $(".main-view").scrollTop(75*(new Date().getHours()-1));

    /* 更新表头元素 */
    function updateTitleWeekDayTable(isFirst){
        var oTable=$(".title-week-day").filter(".active");
        if(isFirst){
            //初始化
            oTable.empty().append(getTitleWeekDayTableHTML(getDayOfOneWeek(0)));
            oTable.prev().empty().append(getTitleWeekDayTableHTML(getDayOfOneWeek(-1)));
            oTable.next().empty().append(getTitleWeekDayTableHTML(getDayOfOneWeek(+1)));
            //对当天高亮
            oTable.find("tr").children().eq(new Date().getDay()+1).addClass("color-today");

        }else{
            var appendHTML='';
            var iPage=parseInt(oTable.attr("data-page"));

            if(oTable.prevAll().size()<2){
                appendHTML+='<table class="title-week title-week-day item" data-page="'+(iPage-2)+'">';
                appendHTML+=getTitleWeekDayTableHTML(getDayOfOneWeek(iPage-2))+"</table>";
                $("#title-week-day").prepend(appendHTML);
            }
            appendHTML='';
            if(oTable.nextAll().size()<2){
                appendHTML+='<table class="title-week title-week-day item" data-page="'+(iPage+2)+'">';
                appendHTML+=getTitleWeekDayTableHTML(getDayOfOneWeek(iPage+2))+"</table>";
                $("#title-week-day").append(appendHTML);
            }

        }
    }


    /* 更新主表元素 */
    function updateMainTable(isFirst){
        var oTable=$(".main-table").filter(".active");
        var iPage=parseInt(oTable.attr("data-page"));
        var aDate;
        if(isFirst){
            //$("#main-view").prepend(getOneWeekMainTable(getDayOfOneWeek(0)));
            var oMainView=$("#main-view");
            oMainView.empty();
            aDate=getDayOfOneWeek(0);
            oMainView.append(getOneWeekMainTable(aDate,0));
            getOrderListByMonth(aDate[0].Format("yyyy-MM-dd"),0);
            aDate=getDayOfOneWeek(-1);
            oMainView.prepend(getOneWeekMainTable(getDayOfOneWeek(-1),1));
//            getOrderListByMonth(aDate[0].Format("yyyy-MM-dd"),-1);
            aDate=getDayOfOneWeek(+1);
            oMainView.append(getOneWeekMainTable(getDayOfOneWeek(1),1));
//            getOrderListByMonth(aDate[0].Format("yyyy-MM-dd"),1);
        }else{
            if(oTable.prevAll().size()<2){
                aDate=getDayOfOneWeek(iPage-2);
                $("#main-view").prepend(getOneWeekMainTable(aDate,iPage-2));
            }
            if(oTable.nextAll().size()<2){
                aDate=getDayOfOneWeek(iPage+2);
                $("#main-view").append(getOneWeekMainTable(aDate,iPage+2));
            }
        }

    }

</script>

</body>
</html>